% !TEX root = ../simfempy.tex
%
%==========================================
\section{Elliptic equation}\label{sec:Heat}
%==========================================
%
Let $\Omega\subset \R^d$, $d=2,3$ be the computational domain. We suppose to have a disjoined partition of its boundary:
$\partial\Omega=\GammaD\cup\GammaN\cup\GammaR$.
%
We consider the second-order elliptic equation for the scalar unknown $u$ with coefficients
%
\begin{align*}
A(x)\in\R^{d\times d},\quad b(x)\in\R^d,\quad c(x)\in\R,\quad \alpha\in\R.
\end{align*}
%
%
\begin{yellowbox}[Elliptic Equation (strong formulation)]
\begin{equation}\label{eq:EllipticEquation}
%
\left\{
\begin{aligned}
-\div\left(A\nabla u\right)+b\cdot\nabla u + c u = f \quad \mbox{in $\Omega$}\\
u = \uD \quad \mbox{on $\GammaD$}\\
\abs{b_n^-} u + \transpose{n}A\nabla u = \qN \quad \mbox{on $\GammaN$}\\
\alpha u + \abs{b_n^-} u + \transpose{n}A\nabla u= \uR \quad \mbox{on $\GammaR$}
\end{aligned}
\right.
%
\end{equation}
For the standard Neumann condition, we need $b_n^-=0$, i.e. $\GammaN$ is part of the outflow boundary.
\end{yellowbox}
%
%
%-------------------------------------------------------------------------
\subsection{Standard weak formulation}\label{subsec:}
%-------------------------------------------------------------------------
%
\begin{yellowbox}[Elliptic Equation (weak formulation)]
Let $H^1_{\phi}:= \SetDef{u\in H^1(\Omega)}{\Rest{u}{\GammaD} = \phi}$. The primal weak formulation looks for 
$u\in H^1_{\uD}$ such that for all $\phi\in H^1_{0}(\Omega)$
%
\begin{equation}\label{eq:EllipticEquationWeak}
\int_{\Omega} A\nabla u \cdot\nabla \phi 
+ \int_{\Omega}(b\cdot \nabla u)\phi
+ \int_{\Omega}cu\phi
+ \int_{\GammaR} \alpha u \phi 
+ \int_{\GammaR\cup\GammaN} \abs{b_n^-} u \phi
= \int_{\Omega} f \phi 
+  \int_{\GammaN} \qN \phi
+  \int_{\GammaR} \uR \phi
\end{equation}
\end{yellowbox}
%
We can derive (\ref{eq:EllipticEquationWeak}) from (\ref{eq:EllipticEquation}) by the divergence theorem
%
\begin{align*}
\int_{\Omega} \div\vec{F} = \int_{\partial\Omega} \vec{F}_n\quad\overbrace{\Longrightarrow}^{F\to F\phi}\quad 
\int_{\Omega} (\div\vec{F}) \phi = -\int_{\Omega} \vec{F}\cdot \nabla\phi + \int_{\partial\Omega} \vec{F}_n\phi,
\end{align*}
%
which gives with $\vec{F}=A\nabla u$ and $\phi\in H^1_{0}(\Omega)$
%
\begin{align*}
\int_{\Omega} \div\left(A\nabla u\right)\phi = 
- \int_{\Omega}A\nabla u\cdot\nabla\phi+ \int_{\GammaN\cup\GammaR} \transpose{n}A\nabla u\phi.
\end{align*}
%
It follows that for a sufficiently smooth solution $u$ of (\ref{eq:EllipticEquationWeak}) we have
%
\begin{align*}
\int_{\Omega}\left( 
-\div\left(A\nabla u\right)+b\cdot\nabla u + c u - f \right)\phi = \int_{\GammaN} \left( \qN-\transpose{n}A\nabla u-\abs{b_n^-} u\right)\phi + \int_{\GammaR} \left(\uR -\transpose{n}A\nabla u- \alpha u- \abs{b_n^-} u\right)\phi
\end{align*}
%
Taking first $\phi$ vanishing on the whole boundary, we find that (\ref{eq:EllipticEquation}) is satisfied almost everywhere in $\Omega$. 
Second, we recover the Neumann and Robin boundary conditions. Notice that the Dirichlet condition is imposed by the space.

Denoting the bilinear form on the left of (\ref{eq:EllipticEquationWeak}) by $a$, we have in case $\uD=0$, taking $\phi=u$, and with
%
%
\begin{align*}
\int_{\Omega}(b\cdot \nabla u)\phi + \int_{\Omega}u (b\cdot \nabla \phi) + \int_{\Omega}(\div b) u\phi = \int_{\partial\Omega}b_n u\phi 
\quad\Rightarrow\quad \int_{\Omega}(b\cdot \nabla u)\phi = - \int_{\Omega}\frac{\div b}{2} u^2 + \int_{\partial\Omega}\frac{b_n}{2} u^2
\end{align*}
%
%
\begin{align*}
a(u,u) = \int_{\Omega} A\nabla u \cdot\nabla u  + \int_{\Omega}(c-\frac{\div b}{2})u^2 + \int_{\GammaR\cup\GammaN}\frac{\abs{b_n}}{2} u^2+ \int_{\GammaR}\alpha u^2.
\end{align*}
%
We obtain coercivity under the standard assumptions
%
\begin{equation}\label{eq:}
\transpose{\xi}A(x)\xi \ge \alpha_0\abs{\xi}^2,\quad c-\frac{\div b}{2}\ge0,\quad \alpha\ge0.
\end{equation}
%
%
%
%-------------------------------------------------------------------------
\subsection{Mixed weak formulation}\label{subsec:}
%-------------------------------------------------------------------------
%
Introducing the flux as an unknown
%
%
\begin{align*}
q := A\nabla u, \quad q\in Q_{\phi} := \SetDef{q\in \Hdiv}{\Rest{q}{\GammaN}=\phi}, \quad C := A^{-1}\\
\end{align*}
%
%
%
\begin{equation}\label{eq:}
%
\left\{
\begin{aligned}
&(u,q) \in L^2(\Omega)\times Q_{\qN}\\
&\int_{\Omega} Cq\cdot p +  \frac{1}{\alpha}\int_{\GammaR} q_np_n+ \int_{\Omega} u\div p &=& \int_{\GammaD}\uD p_n+ \frac{1}{\alpha}\int_{\GammaR}\uR p_n&\quad &\forall p\in Q_0\\
&\int_{\Omega} v\div q - \int_{\Omega} (b\cdot\nabla u + cu)v&=& -\int_{\Omega} fv &\quad&\forall v\in L^2(\Omega).
\end{aligned}
\right.
% 
\end{equation}
%
Integration by parts in the first equation gives
%
\begin{align*}
\int_{\Omega} (Cq-\nabla u)\cdot p =  \int_{\GammaD}(\uD-u) p_n + \int_{\GammaR}( \frac{1}{\alpha}\uR - u -  \frac{1}{\alpha}q_n)p_n 
\end{align*}
%

%
%-------------------------------------------------------------------------
\subsection{Boundary conditions}\label{subsec:}
%-------------------------------------------------------------------------
%
%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
\subsubsection{Nitsche's method}
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
%
%
\begin{equation}\label{eq:laplace:weakform}
%
\left\{
\begin{aligned}
&u_h\in V_h:\quad a_{\Omega}(u_h, \phi) + a_{\partial\Omega}(u_h,\phi) = l_{\Omega}(\phi)+l_{\partial\Omega}(\phi) \quad\forall \phi\in V_h\\
&\begin{aligned}
a_{\Omega}(v,\phi) &:= \int_{\Omega} \mu \nabla u\cdot\nabla\phi \\
 a_{\partial\Omega}(v,\phi) &:= \int_{\GammaD}\frac{\gamma\mu}{h}u\phi - 
 \int_{\GammaD}\mu \left(  \dn{u} \phi + u  \dn{\phi}\right) \\
 l_{\Omega}(\phi) &:= \int_{\Omega} f\phi, \quad
 l_{\partial\Omega}(\phi) = \int_{\GammaD}\mu\uD\left( \frac{\gamma}{h}\phi - \dn{\phi}\right)
\end{aligned}
\end{aligned}
\right.
%
\end{equation}
%
Let $-\div(\mu \nabla z)= 0$ and $\Rest{z}{\GammaD}=1$ and $\Rest{z}{\GammaN}=0$. Then
%
\begin{align*}
\int_{\Omega} \mu \nabla u\cdot\nabla z -\int_{\Omega} fz =&  \int_{\Omega} \left( \mu \nabla u\cdot\nabla z + \div(\mu \nabla u)z\right) 
= \int_{\GammaD}\mu\dn{u}.
\end{align*}
%
Now, if $z_h\in V_h$ such that $z-z_h\in H^1_0(\Omega)$ 
%
\begin{align*}
\int_{\Omega} \mu \nabla (u-u_h)\cdot\nabla(z-z_h) =& \int_{\Omega} f(z-z_h) -\int_{\Omega} \mu \nabla u_h\cdot\nabla(z-z_h)\\
=&\int_{\Omega} fz - \int_{\Omega} \mu \nabla u_h\cdot\nabla z + \int_{\Omega} \mu \nabla u_h\cdot\nabla(z-z_h) -\int_{\Omega} fz_h\\
=&-\int_{\GammaD}\mu\dn{u}+ \int_{\Omega} \mu \nabla (u-u_h)\cdot\nabla z 
+ \int_{\GammaD}\mu(\uD-u_h)\left( \frac{\gamma}{h}z_h - \dn{z_h}\right)+ \int_{\GammaD}\mu \dn{u_h}\\
=&\int_{\GammaD}\mu \dn{u_h}+ \int_{\GammaD}(\uD-u_h)\frac{\mu\gamma}{h} -\int_{\GammaD}\mu\dn{u}
+ \int_{\GammaD}\mu(u-u_h) \dn{(z-z_h)},
\end{align*}
%
so we get a possibly second-order approximation of the flux by
%
\begin{equation}\label{eq:}
F_h := \int_{\GammaD}\mu \dn{u_h}+ \int_{\GammaD}(\uD-u_h)\frac{\mu\gamma}{h}.
\end{equation}
%
%
%-------------------------------------------------------------------------
\subsection{Computation of the matrices for $\Pspace_h^1(\Omega)$}\label{subsec:}
%-------------------------------------------------------------------------
%
For the convection, we suppose that $\vec{v}\in \RT^0_h(\Omega)$ and let for given $K\in\Cells_h$ 
$\vec{v}=\sum_{k=1}^{d+1} v_k \Phi_k$. Using
%
\begin{align*}
x_k = x_{S_k}^K,\quad h_k = h_{S_k}^K, \quad \sigma_k = \sigma_{S_k}^K, n_k = n_{S_k}
\end{align*}
%
we compute
%
\begin{align*}
\int_K \lambda_j \vec{v}\cdot \nabla \lambda_i = \sum_{k=1}^{d+1} v_k \int_K \lambda_j \Phi_k\cdot \nabla \lambda_i\\
\int_K \lambda_j \Phi_k\cdot \nabla \lambda_i = -\frac{\sigma_k \sigma_i}{h_kh_i} \int_K  \lambda_j (x-x_k) \cdot n_i
= -\frac{\sigma_k \sigma_i}{h_kh_i} \sum_{l=1}^{d+1} (x_l-x_k) \cdot n_i \int_K  \lambda_j\lambda_l 
\end{align*}
%




%==========================================
\printbibliography[title=References Section~\thesection]
%==========================================



